{% extends 'base.html' %}
{% load static %}
{# ØªÙ… Ø¥Ø²Ø§Ù„Ø© load humanize #}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - ÙƒÙ†ÙˆØ²{% endblock %}

{% block extra_css %}
<!-- Ù…ÙƒØªØ¨Ø© Leaflet Ù„Ù„Ø®Ø±Ø§Ø¦Ø· -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

<style>
    /* ===== Ø£Ù†Ù…Ø§Ø· Ø¹Ø§Ù…Ø© ===== */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        --danger-gradient: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        --info-gradient: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
        --dark-gradient: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    }

    .analytics-wrapper {
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }
    
    .dark .analytics-wrapper {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    /* ===== ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ===== */
    .analytics-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }

    .analytics-header::before {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.1;
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    /* ===== Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== */
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.5s ease;
    }
    
    .dark .stat-card {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-card:hover {
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        transform: scale(1.02);
    }

    .stat-card-gradient {
        position: relative;
        overflow: hidden;
    }

    .stat-card-gradient::before {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.1;
        background: var(--primary-gradient);
    }

    /* ===== Ø®Ø±Ø§Ø¦Ø· ===== */
    .map-container {
        border-radius: 1.5rem;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        border: 1px solid #e2e8f0;
        height: 500px;
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
    }
    
    .dark .map-container {
        border: 1px solid #475569;
    }

    /* ===== Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© ===== */
    .chart-wrapper {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-height: 400px;
    }
    
    .dark .chart-wrapper {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ===== Ø¬Ø¯Ø§ÙˆÙ„ ===== */
    .analytics-table {
        width: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .dark .analytics-table {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .table-header {
        background: linear-gradient(to right, #f8fafc, #f1f5f9);
        padding: 1rem 1.5rem;
        font-weight: bold;
        color: #1e293b;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .dark .table-header {
        background: linear-gradient(to right, #1e293b, #334155);
        color: #f1f5f9;
        border-bottom: 1px solid #475569;
    }

    .table-row {
        border-bottom: 1px solid #f1f5f9;
    }
    
    .dark .table-row {
        border-bottom: 1px solid #334155;
    }

    .table-row:hover {
        background: rgba(0, 0, 0, 0.02);
    }
    
    .dark .table-row:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .table-cell {
        padding: 1rem 1.5rem;
        color: #475569;
    }
    
    .dark .table-cell {
        color: #cbd5e1;
    }

    /* ===== Ø£Ø²Ø±Ø§Ø± ===== */
    .analytics-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: all 0.3s ease;
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background: var(--primary-gradient);
        color: white;
        border: none;
        cursor: pointer;
    }

    .analytics-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .analytics-btn:active {
        transform: translateY(0);
    }

    .analytics-btn-secondary {
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: all 0.3s ease;
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: inherit;
        cursor: pointer;
    }
    
    .dark .analytics-btn-secondary {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ===== ÙÙ„Ø§ØªØ± ===== */
    .filter-group {
        display: inline-flex;
        flex-direction: row-reverse;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        padding: 0.5rem;
        border-radius: 1.5rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .dark .filter-group {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid #475569;
    }

    .filter-btn {
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
        background: transparent;
        color: inherit;
        cursor: pointer;
    }

    .filter-btn.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    /* ===== Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ ===== */
    .realtime-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        animation: pulse 2s infinite;
        background: var(--success-gradient);
        color: white;
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }

    /* ===== ØªØ£Ø«ÙŠØ±Ø§Øª GSAP ===== */
    .floating-element {
        animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0px);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    .glow-effect {
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .glow-effect:hover {
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
    }

    /* ===== Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆÙ„ ===== */
    .country-flag {
        font-size: 1.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    }

    /* ===== ØªÙ„Ù…ÙŠØ­Ø§Øª ===== */
    .tooltip {
        visibility: hidden;
        position: absolute;
    }

    .has-tooltip:hover .tooltip {
        visibility: visible;
        z-index: 50;
    }

    /* ===== Ø±Ù…ÙˆØ² Ø§Ø­ØªØ±Ø§ÙÙŠØ© ===== */
    .icon-wrapper {
        width: 4rem;
        height: 4rem;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
    }

    /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ ===== */
    .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 10px;
    }
    
    .dark .custom-scrollbar::-webkit-scrollbar-track {
        background: #334155;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 10px;
    }

    /* ===== ÙƒØ±ÙˆØª Ø§Ù„Ø¯ÙˆÙ„ ===== */
    .country-card {
        position: relative;
        overflow: hidden;
        border-radius: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 0.9) 0%, 
            rgba(255, 255, 255, 0.7) 100%);
    }
    
    .dark .country-card {
        background: linear-gradient(135deg, 
            rgba(30, 41, 59, 0.9) 0%, 
            rgba(30, 41, 59, 0.7) 100%);
    }

    .country-card:hover {
        transform: scale(1.02);
    }

    .country-card::before {
        content: '';
        position: absolute;
        inset: 0;
        opacity: 0.05;
        background-size: 20px 20px;
        background-image: 
            linear-gradient(to right, #ccc 1px, transparent 1px),
            linear-gradient(to bottom, #ccc 1px, transparent 1px);
    }

    /* ===== ØªØ£Ø«ÙŠØ±Ø§Øª Ø¯Ø®ÙˆÙ„ ===== */
    .fade-in-up {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ===== ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ===== */
    .big-number {
        font-size: 2.25rem;
        font-weight: bold;
        letter-spacing: -0.025em;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ===== ÙƒØ±ÙˆØª Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ ===== */
    .realtime-card {
        position: relative;
        overflow: hidden;
        border-radius: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.2);
        background: linear-gradient(135deg, 
            rgba(16, 185, 129, 0.1) 0%, 
            rgba(34, 197, 94, 0.05) 100%);
    }

    .realtime-card::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 8rem;
        height: 8rem;
        background: rgba(34, 197, 94, 0.1);
        border-radius: 50%;
        margin-right: -4rem;
        margin-top: -4rem;
    }

    /* ===== ØªÙ‚Ø¯Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ===== */
    .percentage-ring {
        width: 120px;
        height: 120px;
    }

    .progress-ring {
        transform: rotate(-90deg);
    }

    .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(90deg);
        transform-origin: 50% 50%;
    }

    /* ===== Ù†Øµ Ù…ØªØ¯Ø±Ø¬ ===== */
    .text-gradient {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ===== ØªØ£Ø«ÙŠØ± Ø±ÙØ¹ Ø¹Ù†Ø¯ hover ===== */
    .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    /* ===== Ø´Ø¨ÙƒØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ===== */
    .icon-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
        gap: 10px;
    }

    /* ===== Ø®Ø·ÙˆØ· Ù…ØªØ¯Ø±Ø¬Ø© ===== */
    .gradient-border {
        position: relative;
        border: double 3px transparent;
        border-radius: 1rem;
        background-image: linear-gradient(white, white), 
                          var(--primary-gradient);
        background-origin: border-box;
        background-clip: padding-box, border-box;
    }
    
    .dark .gradient-border {
        background-image: linear-gradient(#1e293b, #1e293b), 
                          var(--primary-gradient);
    }
</style>
{% endblock %}

{% block content %}
<div class="analytics-wrapper">
    <!-- ===== ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ===== -->
    <header class="analytics-header text-white py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto relative z-10">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-3 space-x-reverse mb-4">
                        <div class="icon-wrapper">
                            <i class="fas fa-chart-network"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold mb-2">
                                ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                            </h1>
                            <p class="text-blue-200 text-lg">
                                Ø±ØµØ¯ ÙˆØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ ÙƒÙ†ÙˆØ²
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mt-4">
                        <div class="realtime-badge">
                            <i class="fas fa-circle mr-2 text-xs"></i>
                            <span id="onlineCount">{{ realtime_visitors|length }}</span> Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†
                        </div>
                        <div class="px-3 py-1 bg-white/10 backdrop-blur-sm rounded-full text-sm">
                            <i class="fas fa-calendar-day mr-2"></i>
                            {{ today|date:"Y/m/d" }}
                        </div>
                        <div class="px-3 py-1 bg-white/10 backdrop-blur-sm rounded-full text-sm">
                            <i class="fas fa-clock mr-2"></i>
                            <span id="currentTime">{{ current_time|time:"H:i" }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3 space-x-reverse">
                    <button onclick="refreshDashboard()" 
                            class="analytics-btn-secondary flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>
                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <button onclick="exportData()" 
                            class="analytics-btn flex items-center">
                        <i class="fas fa-file-export mr-2"></i>
                        ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±
                    </button>
                </div>
            </div>
            
            <!-- ÙÙ„Ø§ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© -->
            <div class="mt-8">
                <div class="filter-group">
                    <button class="filter-btn active" data-period="today">
                        Ø§Ù„ÙŠÙˆÙ…
                    </button>
                    <button class="filter-btn" data-period="7d">
                        7 Ø£ÙŠØ§Ù…
                    </button>
                    <button class="filter-btn" data-period="30d">
                        30 ÙŠÙˆÙ…
                    </button>
                    <button class="filter-btn" data-period="90d">
                        90 ÙŠÙˆÙ…
                    </button>
                    <button class="filter-btn" data-period="1y">
                        Ø³Ù†Ø©
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª -->
            <div class="stat-card stat-card-gradient fade-in-up" style="animation-delay: 0.1s">
                <div class="flex items-start justify-between mb-4">
                    <div class="icon-wrapper mb-4" style="background: var(--primary-gradient)">
                        <i class="fas fa-eye text-white"></i>
                    </div>
                    <div class="text-right">
                        <span class="text-sm px-3 py-1 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">
                            <i class="fas fa-arrow-up mr-1"></i>
                            12.5%
                        </span>
                    </div>
                </div>
                <div class="big-number mb-2">
                    {{ stats.total_sessions }}
                </div>
                <h3 class="text-gray-500 dark:text-gray-400 font-medium">
                    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
                </h3>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">
                    <i class="fas fa-history mr-1"></i>
                    Ù…Ù†Ø° Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                </p>
            </div>

            <!-- Ø²ÙˆØ§Ø± Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù† -->
            <div class="stat-card stat-card-gradient fade-in-up" style="animation-delay: 0.2s">
                <div class="flex items-start justify-between mb-4">
                    <div class="icon-wrapper mb-4" style="background: var(--success-gradient)">
                        <i class="fas fa-wifi text-white"></i>
                    </div>
                    <div class="text-right">
                        <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                    </div>
                </div>
                <div class="big-number mb-2">
                    {{ stats.active_sessions }}
                </div>
                <h3 class="text-gray-500 dark:text-gray-400 font-medium">
                    Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†
                </h3>
                <div class="mt-2">
                    <div class="flex items-center text-sm text-gray-400">
                        <i class="fas fa-globe-americas mr-2"></i>
                        <span id="onlineCountries">{{ geographic_data.total_countries }}</span> Ø¯ÙˆÙ„Ø© Ù†Ø´Ø·Ø©
                    </div>
                </div>
            </div>

            <!-- Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª -->
            <div class="stat-card stat-card-gradient fade-in-up" style="animation-delay: 0.3s">
                <div class="flex items-start justify-between mb-4">
                    <div class="icon-wrapper mb-4" style="background: var(--warning-gradient)">
                        <i class="fas fa-clock text-white"></i>
                    </div>
                    <div class="text-right">
                        <span class="text-sm px-3 py-1 rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                            <i class="fas fa-chart-line mr-1"></i>
                            5.2%
                        </span>
                    </div>
                </div>
                <div class="big-number mb-2">
                    {{ stats.avg_session_duration|default:"0:00" }}
                </div>
                <h3 class="text-gray-500 dark:text-gray-400 font-medium">
                    Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª
                </h3>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">
                    <i class="fas fa-hourglass-half mr-1"></i>
                    Ù„ÙƒÙ„ Ø²ÙŠØ§Ø±Ø©
                </p>
            </div>

            <!-- Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯ -->
            <div class="stat-card stat-card-gradient fade-in-up" style="animation-delay: 0.4s">
                <div class="flex items-start justify-between mb-4">
                    <div class="icon-wrapper mb-4" style="background: var(--danger-gradient)">
                        <i class="fas fa-sign-out-alt text-white"></i>
                    </div>
                    <div class="text-right">
                        <span class="text-sm px-3 py-1 rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400">
                            <i class="fas fa-arrow-down mr-1"></i>
                            3.1%
                        </span>
                    </div>
                </div>
                <div class="big-number mb-2">
                    {{ stats.bounce_rate|floatformat:1 }}%
                </div>
                <h3 class="text-gray-500 dark:text-gray-400 font-medium">
                    Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯
                </h3>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">
                    <i class="fas fa-chart-pie mr-1"></i>
                    Ù†Ø³Ø¨Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
                </p>
            </div>
        </div>

        <!-- ===== Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ===== -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… -->
            <div class="fade-in-up" style="animation-delay: 0.5s">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center">
                        <i class="fas fa-map-marked-alt mr-2 text-blue-600 dark:text-blue-400"></i>
                        Ø®Ø±ÙŠØ·Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§Ø±
                    </h2>
                    <button onclick="refreshMap()" 
                            class="analytics-btn-secondary text-sm">
                        <i class="fas fa-sync-alt mr-1"></i>
                        ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
                <div class="map-container" id="worldMap">
                    <div class="h-full flex items-center justify-center text-white">
                        <div class="text-center">
                            <i class="fas fa-globe-americas text-6xl mb-4 opacity-50"></i>
                            <p class="text-xl">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
                <div class="grid grid-cols-3 gap-4 mt-4">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 flex items-center justify-between hover-lift">
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·Ø©</div>
                            <div class="text-2xl font-bold text-gray-800 dark:text-white">
                                {{ geographic_data.total_countries }}
                            </div>
                        </div>
                        <i class="fas fa-globe-africa text-3xl text-blue-500 dark:text-blue-400"></i>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-emerald-100 dark:from-green-900/20 dark:to-emerald-800/20 rounded-xl p-4 flex items-center justify-between hover-lift">
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                            <div class="text-xl font-bold text-gray-800 dark:text-white">
                                {{ geographic_data.top_country.name }}
                            </div>
                        </div>
                        <div class="text-3xl">
                            {% if geographic_data.top_country.name == 'Ù…ØµØ±' %}ğŸ‡ªğŸ‡¬
                            {% elif geographic_data.top_country.name == 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' %}ğŸ‡¸ğŸ‡¦
                            {% elif geographic_data.top_country.name == 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª' %}ğŸ‡¦ğŸ‡ª
                            {% elif geographic_data.top_country.name == 'Ù‚Ø·Ø±' %}ğŸ‡¶ğŸ‡¦
                            {% elif geographic_data.top_country.name == 'Ø§Ù„ÙƒÙˆÙŠØª' %}ğŸ‡°ğŸ‡¼
                            {% else %}ğŸ³ï¸{% endif %}
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-pink-100 dark:from-purple-900/20 dark:to-pink-800/20 rounded-xl p-4 flex items-center justify-between hover-lift">
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Ù†Ø³Ø¨Ø© Ø§Ù„Ø°Ø±ÙˆØ©</div>
                            <div class="text-2xl font-bold text-gray-800 dark:text-white">
                                {% if geographic_data.countries %}
                                    {{ geographic_data.countries.0.percentage|floatformat:1 }}%
                                {% else %}0%{% endif %}
                            </div>
                        </div>
                        <i class="fas fa-chart-line text-3xl text-purple-500 dark:text-purple-400"></i>
                    </div>
                </div>
            </div>

            <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¯ÙˆÙ„ -->
            <div class="fade-in-up" style="animation-delay: 0.6s">
                <div class="chart-wrapper">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-flag mr-2 text-green-600 dark:text-green-400"></i>
                            ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
                        </h3>
                        <select id="countriesPeriod" 
                                class="bg-gray-100 dark:bg-gray-700 border-0 rounded-lg px-4 py-2 text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                            <option value="7d">Ø£Ø³Ø¨ÙˆØ¹</option>
                            <option value="30d" selected>Ø´Ù‡Ø±</option>
                            <option value="90d">3 Ø£Ø´Ù‡Ø±</option>
                            <option value="1y">Ø³Ù†Ø©</option>
                        </select>
                    </div>
                    
                    <div class="overflow-x-auto custom-scrollbar">
                        <div class="min-w-full">
                            <div class="grid grid-cols-12 gap-4 mb-4 px-2">
                                <div class="col-span-1 text-center text-sm text-gray-500 dark:text-gray-400">
                                    #
                                </div>
                                <div class="col-span-5 text-right text-sm text-gray-500 dark:text-gray-400">
                                    Ø§Ù„Ø¯ÙˆÙ„Ø©
                                </div>
                                <div class="col-span-3 text-center text-sm text-gray-500 dark:text-gray-400">
                                    Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
                                </div>
                                <div class="col-span-3 text-center text-sm text-gray-500 dark:text-gray-400">
                                    Ø§Ù„Ù†Ø³Ø¨Ø©
                                </div>
                            </div>
                            
                            <div class="space-y-3 max-h-80 overflow-y-auto custom-scrollbar">
                                {% for country in countries_data|slice:":10" %}
                                <div class="grid grid-cols-12 gap-4 items-center p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group">
                                    <div class="col-span-1 text-center">
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center mx-auto {% if forloop.counter < 4 %}bg-gradient-to-r 
                                            {% if forloop.counter == 1 %}from-yellow-500 to-yellow-600
                                            {% elif forloop.counter == 2 %}from-gray-400 to-gray-500
                                            {% else %}from-amber-700 to-amber-800{% endif %} text-white
                                            {% else %}bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300{% endif %}">
                                            {{ forloop.counter }}
                                        </div>
                                    </div>
                                    
                                    <div class="col-span-5">
                                        <div class="flex items-center">
                                            <div class="country-flag mr-3">
                                                {{ country.flag }}
                                            </div>
                                            <div>
                                                <div class="font-medium text-gray-800 dark:text-white">
                                                    {{ country.name }}
                                                </div>
                                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                                    {{ country.avg_time }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-span-3 text-center">
                                        <div class="font-bold text-lg">{{ country.visits }}</div>
                                    </div>
                                    
                                    <div class="col-span-3">
                                        <div class="relative pt-1">
                                            <div class="flex items-center justify-between">
                                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                                    <div class="h-2.5 rounded-full 
                                                        {% if forloop.counter == 1 %}bg-gradient-to-r from-yellow-500 to-yellow-600
                                                        {% elif forloop.counter == 2 %}bg-gradient-to-r from-gray-400 to-gray-500
                                                        {% elif forloop.counter == 3 %}bg-gradient-to-r from-amber-700 to-amber-800
                                                        {% else %}bg-gradient-to-r from-blue-500 to-blue-600{% endif %}" 
                                                        style="width: {{ country.percentage|floatformat:0 }}%">
                                                    </div>
                                                </div>
                                                <span class="mr-2 text-sm font-medium">
                                                    {{ country.percentage|floatformat:1 }}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="text-center py-8">
                                    <i class="fas fa-flag text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
                                    <p class="text-gray-500 dark:text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¯ÙˆÙ„</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø¬Ù„Ø³Ø§Øª ===== -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆÙ‚Øª -->
            <div class="fade-in-up" style="animation-delay: 0.7s">
                <div class="chart-wrapper">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-clock mr-2 text-purple-600 dark:text-purple-400"></i>
                            ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
                        </h3>
                        <div class="flex space-x-2">
                            <button onclick="changeTimeChart('hour')" 
                                    class="text-sm px-3 py-1 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                Ø³Ø§Ø¹Ø§Øª
                            </button>
                            <button onclick="changeTimeChart('weekday')" 
                                    class="text-sm px-3 py-1 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                Ø£ÙŠØ§Ù…
                            </button>
                            <button onclick="changeTimeChart('day')" 
                                    class="text-sm px-3 py-1 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                ØªØ§Ø±ÙŠØ®
                            </button>
                        </div>
                    </div>
                    
                    <div class="h-64">
                        <canvas id="timeChart"></canvas>
                    </div>
                    
                    <div class="mt-6 grid grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl hover-lift">
                            <div class="text-sm text-gray-500 dark:text-gray-400">ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ©</div>
                            <div class="text-xl font-bold text-gray-800 dark:text-white">
                                {{ peak_time.time|default:"14:00" }}
                            </div>
                        </div>
                        
                        <div class="text-center p-4 bg-gradient-to-r from-green-50 to-emerald-100 dark:from-green-900/20 dark:to-emerald-800/20 rounded-xl hover-lift">
                            <div class="text-sm text-gray-500 dark:text-gray-400">Ø£Ù‚Ù„ ÙˆÙ‚Øª</div>
                            <div class="text-xl font-bold text-gray-800 dark:text-white">
                                04:00
                            </div>
                        </div>
                        
                        <div class="text-center p-4 bg-gradient-to-r from-purple-50 to-pink-100 dark:from-purple-900/20 dark:to-pink-800/20 rounded-xl hover-lift">
                            <div class="text-sm text-gray-500 dark:text-gray-400">ÙØ±Ù‚ Ø§Ù„Ù†Ø³Ø¨Ø©</div>
                            <div class="text-xl font-bold text-green-600 dark:text-green-400">
                                +350%
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© -->
            <div class="fade-in-up" style="animation-delay: 0.8s">
                <div class="chart-wrapper">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-history mr-2 text-indigo-600 dark:text-indigo-400"></i>
                            Ø£Ø­Ø¯Ø« Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±
                        </h3>
                        <button onclick="loadRecentSessions()" 
                                class="text-sm px-4 py-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-800/50">
                            <i class="fas fa-sync-alt mr-1"></i>
                            ØªØ­Ø¯ÙŠØ«
                        </button>
                    </div>
                    
                    <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                        {% for session in recent_sessions|slice:":6" %}
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800/50 dark:to-gray-900/50 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover-lift">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div class="country-flag mr-3">
                                        {{ session.flag }}
                                    </div>
                                    <div>
                                        <div class="font-medium text-gray-800 dark:text-white">
                                            {{ session.country }}
                                        </div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">
                                            {{ session.device }}
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-gray-800 dark:text-white">
                                        {{ session.pages }}
                                        <span class="text-sm text-gray-500">ØµÙØ­Ø©</span>
                                    </div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                        {{ session.duration }}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <div class="text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    {{ session.start_time|timesince }}
                                </div>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 rounded-full 
                                        {% if session.is_active %}bg-green-500 animate-pulse
                                        {% else %}bg-gray-400{% endif %} mr-2"></div>
                                    <span class="{% if session.is_active %}text-green-600 dark:text-green-400{% else %}text-gray-500{% endif %}">
                                        {% if session.is_active %}Ù†Ø´Ø·Ø© Ø§Ù„Ø¢Ù†{% else %}Ù…Ù†ØªÙ‡ÙŠØ©{% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8">
                            <i class="fas fa-users text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ø­Ø¯ÙŠØ«Ø©</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Ø£ÙØ¶Ù„ Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ§Ù„Ø²ÙˆØ§Ø± Ø§Ù„ÙÙˆØ±ÙŠÙŠÙ† ===== -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Ø£ÙØ¶Ù„ Ø§Ù„ØµÙØ­Ø§Øª -->
            <div class="fade-in-up" style="animation-delay: 0.9s">
                <div class="chart-wrapper">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-fire mr-2 text-red-600 dark:text-red-400"></i>
                            Ø£ÙØ¶Ù„ Ø§Ù„ØµÙØ­Ø§Øª Ù…Ø´Ø§Ù‡Ø¯Ø©
                        </h3>
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            Ø£Ø¹Ù„Ù‰ 10 ØµÙØ­Ø§Øª
                        </div>
                    </div>
                    
                    <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                        {% for page in top_pages %}
                        <div class="group hover-lift">
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-700">
                                <div class="flex items-center flex-1 min-w-0">
                                    <div class="w-10 h-10 rounded-lg 
                                        {% cycle 'bg-gradient-to-r from-blue-500 to-blue-600' 
                                                 'bg-gradient-to-r from-green-500 to-green-600' 
                                                 'bg-gradient-to-r from-yellow-500 to-yellow-600' 
                                                 'bg-gradient-to-r from-purple-500 to-purple-600' 
                                                 'bg-gradient-to-r from-pink-500 to-pink-600' %} 
                                        flex items-center justify-center text-white ml-4">
                                        {{ forloop.counter }}
                                    </div>
                                    <div class="mr-4 flex-1 min-w-0">
                                        <div class="font-medium text-gray-800 dark:text-white truncate">
                                            {{ page.title|default:"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" }}
                                        </div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400 truncate">
                                            {{ page.url|truncatechars:50 }}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-6 space-x-reverse">
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-gray-800 dark:text-white">
                                            {{ page.views }}
                                        </div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">
                                            Ù…Ø´Ø§Ù‡Ø¯Ø©
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-gray-800 dark:text-white">
                                            {{ page.avg_time|default:"0:00" }}
                                        </div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">
                                            Ù…ØªÙˆØ³Ø·
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8">
                            <i class="fas fa-file-alt text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØµÙØ­Ø§Øª</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„ÙÙˆØ±ÙŠÙŠÙ† -->
            <div class="fade-in-up" style="animation-delay: 1s">
                <div class="chart-wrapper">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-bolt mr-2 text-green-600 dark:text-green-400"></i>
                            Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
                        </h3>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse mr-2"></div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">
                                {{ realtime_visitors|length }} Ù…ØªØµÙ„
                            </span>
                        </div>
                    </div>
                    
                    <div class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar">
                        {% for visitor in realtime_visitors|slice:":5" %}
                        <div class="realtime-card">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div class="country-flag mr-3">
                                        {{ visitor.flag }}
                                    </div>
                                    <div>
                                        <div class="font-medium text-gray-800 dark:text-white">
                                            {{ visitor.country }}
                                        </div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">
                                            {{ visitor.city|default:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ" }}
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-gray-800 dark:text-white">
                                        {{ visitor.time_on_page|floatformat:0 }}
                                        <span class="text-sm text-gray-500">Ø«Ø§Ù†ÙŠØ©</span>
                                    </div>
                                    <div class="text-sm {% if visitor.is_new %}text-green-600 dark:text-green-400{% else %}text-gray-500{% endif %}">
                                        {% if visitor.is_new %}Ø¬Ø¯ÙŠØ¯{% else %}Ù…Ø³ØªÙ…Ø±{% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <div class="text-gray-500 dark:text-gray-400 truncate max-w-xs">
                                    <i class="fas fa-link mr-1"></i>
                                    {{ visitor.current_page|truncatechars:40 }}
                                </div>
                                <div class="text-gray-500 dark:text-gray-400">
                                    {{ visitor.device }}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8">
                            <i class="fas fa-user-clock text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²ÙˆØ§Ø± Ù…ØªØµÙ„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ===== -->
        <div class="flex flex-wrap justify-center gap-4 mb-8 fade-in-up" style="animation-delay: 1.2s">
            <button onclick="showFullReport()" 
                    class="analytics-btn flex items-center">
                <i class="fas fa-chart-bar mr-2"></i>
                Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
            </button>
            
            <button onclick="exportToPDF()" 
                    class="analytics-btn-secondary flex items-center">
                <i class="fas fa-file-pdf mr-2"></i>
                ØªØµØ¯ÙŠØ± PDF
            </button>
            
            <button onclick="exportToCSV()" 
                    class="analytics-btn-secondary flex items-center">
                <i class="fas fa-file-csv mr-2"></i>
                ØªØµØ¯ÙŠØ± CSV
            </button>
            
            <button onclick="showSettings()" 
                    class="analytics-btn-secondary flex items-center">
                <i class="fas fa-cog mr-2"></i>
                Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>
    </main>

    <!-- ===== Ø§Ù„ØªØ°ÙŠÙŠÙ„ ===== -->
    <footer class="bg-gradient-to-r from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-900 text-white py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-2xl text-blue-400 mr-3"></i>
                        <div>
                            <h4 class="text-lg font-bold">Ù…Ù†ØµØ© ÙƒÙ†ÙˆØ² Ù„Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h4>
                            <p class="text-gray-400 text-sm">
                                Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„ØªØ­Ù„ÙŠÙ„ ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center md:text-right">
                    <p class="text-gray-400 mb-2">
                        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdateTime">{{ current_time|date:"H:i:s" }}</span>
                    </p>
                    <div class="flex items-center justify-center md:justify-end space-x-4">
                        <button onclick="refreshAll()" 
                                class="text-sm px-3 py-1 bg-white/10 rounded-lg hover:bg-white/20 transition-colors">
                            <i class="fas fa-sync-alt mr-1"></i>
                            ØªØ­Ø¯ÙŠØ« Ø³Ø±ÙŠØ¹
                        </button>
                        <button onclick="toggleAutoRefresh()" 
                                class="text-sm px-3 py-1 bg-green-500/20 rounded-lg hover:bg-green-500/30 transition-colors">
                            <i class="fas fa-robot mr-1"></i>
                            <span id="autoRefreshStatus">ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-8 border-t border-gray-700 text-center text-gray-500 text-sm">
                <p>
                    Â© {% now "Y" %} Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ù…Ù†ØµØ© ÙƒÙ†ÙˆØ². 
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
                </p>
                <p class="mt-1">
                    ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Django, Chart.js, Leaflet.js, Tailwind CSS
                </p>
            </div>
        </div>
    </footer>
</div>

<!-- ===== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== -->
<div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center">
                <i class="fas fa-cogs mr-3 text-blue-600 dark:text-blue-400"></i>
                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
            </h3>
            <button onclick="closeSettings()" 
                    class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        
        <div class="space-y-6">
            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØªØ±Ø© -->
            <div>
                <h4 class="text-lg font-medium text-gray-800 dark:text-white mb-3">
                    â° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
                </h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                        </label>
                        <select class="w-full bg-gray-100 dark:bg-gray-700 border-0 rounded-lg px-4 py-2 text-gray-700 dark:text-gray-300">
                            <option value="7d">Ø£Ø³Ø¨ÙˆØ¹</option>
                            <option value="30d" selected>Ø´Ù‡Ø±</option>
                            <option value="90d">3 Ø£Ø´Ù‡Ø±</option>
                            <option value="1y">Ø³Ù†Ø©</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                        </label>
                        <select class="w-full bg-gray-100 dark:bg-gray-700 border-0 rounded-lg px-4 py-2 text-gray-700 dark:text-gray-300">
                            <option value="30">30 Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="60">Ø¯Ù‚ÙŠÙ‚Ø©</option>
                            <option value="300">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
                            <option value="0">Ù…Ø¹Ø·Ù„</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ -->
            <div>
                <h4 class="text-lg font-medium text-gray-800 dark:text-white mb-3">
                    ğŸ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
                </h4>
                <div class="space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" checked 
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700">
                        <span class="mr-2 text-gray-700 dark:text-gray-300">
                            Ø¹Ø±Ø¶ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ù„Ù…
                        </span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" checked 
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700">
                        <span class="mr-2 text-gray-700 dark:text-gray-300">
                            Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„ÙÙˆØ±ÙŠÙŠÙ†
                        </span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" 
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700">
                        <span class="mr-2 text-gray-700 dark:text-gray-300">
                            ØªÙ…ÙƒÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¶ØºÙˆØ·
                        </span>
                    </label>
                </div>
            </div>
            
            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ© -->
            <div>
                <h4 class="text-lg font-medium text-gray-800 dark:text-white mb-3">
                    ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©
                </h4>
                <div class="space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" checked 
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700">
                        <span class="mr-2 text-gray-700 dark:text-gray-300">
                            Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ÙˆÙŠÙ† IP
                        </span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" 
                               class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 dark:border-gray-600 dark:bg-gray-700">
                        <span class="mr-2 text-gray-700 dark:text-gray-300">
                            Ø¹Ø¯Ù… ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
                        </span>
                    </label>
                </div>
            </div>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ -->
            <div class="flex justify-end space-x-3 space-x-reverse pt-4">
                <button onclick="closeSettings()" 
                        class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <button onclick="saveSettings()" 
                        class="px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:shadow-lg">
                    Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Ù…ÙƒØªØ¨Ø§Øª JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
// ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© =====
let timeChart = null;

function initTimeChart() {
    const ctx = document.getElementById('timeChart').getContext('2d');
    
    // Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
    const labels = Array.from({length: 24}, (_, i) => `${i.toString().padStart(2, '0')}:00`);
    const dataPoints = labels.map((_, i) => {
        // ØªÙˆØ²ÙŠØ¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ
        const hour = i;
        if (hour >= 9 && hour <= 17) {
            return Math.floor(Math.random() * 1000) + 500; // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„
        } else if (hour >= 20 || hour <= 2) {
            return Math.floor(Math.random() * 800) + 300; // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¡
        } else {
            return Math.floor(Math.random() * 200) + 50; // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
        }
    });
    
    timeChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                data: dataPoints,
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#8b5cf6',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.raw.toLocaleString('ar-EG')} Ø¬Ù„Ø³Ø©`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)',
                    },
                    ticks: {
                        color: '#6b7280',
                        maxTicksLimit: 12,
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)',
                    },
                    ticks: {
                        color: '#6b7280',
                        callback: function(value) {
                            return value.toLocaleString('ar-EG');
                        }
                    }
                }
            }
        }
    });
}

// ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© =====
let worldMap = null;

function initWorldMap() {
    const mapContainer = document.getElementById('worldMap');
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø±ÙŠØ·Ø© Ù…Ø¤Ù‚ØªØ© Ù…Ø¹ ØªØµÙ…ÙŠÙ… Ø¬Ù…ÙŠÙ„
    mapContainer.innerHTML = `
        <div class="h-full flex flex-col items-center justify-center text-white p-8">
            <div class="text-center mb-6">
                <i class="fas fa-globe-americas text-8xl mb-6 opacity-20"></i>
                <h3 class="text-2xl font-bold mb-2">Ø®Ø±ÙŠØ·Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§Ø±</h3>
                <p class="text-blue-200 opacity-80">
                    Ø¹Ø±Ø¶ ØªÙØ§Ø¹Ù„ÙŠ Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§Ø± Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù„Ù…
                </p>
            </div>
            <div class="grid grid-cols-3 gap-4 w-full max-w-md">
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold mb-1">{{ geographic_data.total_countries }}</div>
                    <div class="text-sm opacity-80">Ø¯ÙˆÙ„Ø©</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold mb-1">{{ geographic_data.total_visits }}</div>
                    <div class="text-sm opacity-80">Ø²ÙŠØ§Ø±Ø©</div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold mb-1">
                        {% if geographic_data.top_country.visits %}
                            {{ geographic_data.top_country.visits }}
                        {% else %}0{% endif %}
                    </div>
                    <div class="text-sm opacity-80">Ø§Ù„Ø£ÙˆÙ„Ù‰</div>
                </div>
            </div>
            <button onclick="loadRealMap()" 
                    class="mt-8 px-6 py-3 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors">
                <i class="fas fa-map mr-2"></i>
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
            </button>
        </div>
    `;
}

function loadRealMap() {
    const mapContainer = document.getElementById('worldMap');
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    worldMap = L.map(mapContainer).setView([20, 0], 2);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        noWrap: true,
    }).addTo(worldMap);
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ù„Ø¯ÙˆÙ„ (Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶)
    const countries = {{ geographic_data.countries|safe|default:"[]" }};
    
    const markers = L.markerClusterGroup();
    
    countries.forEach((country, index) => {
        // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ
        const lat = 20 + (Math.random() * 40 - 20);
        const lng = (Math.random() * 100 - 50);
        
        const marker = L.marker([lat, lng], {
            icon: L.divIcon({
                html: `
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-r 
                                    from-blue-500 to-purple-600 text-white 
                                    flex items-center justify-center font-bold 
                                    shadow-lg border-2 border-white 
                                    transform hover:scale-110 transition-transform">
                            ${country.flag || 'ğŸ³ï¸'}
                        </div>
                        <div class="absolute -top-2 -right-2 w-6 h-6 
                                    rounded-full bg-red-500 text-white 
                                    text-xs flex items-center justify-center 
                                    font-bold shadow-lg">
                            ${country.visits}
                        </div>
                    </div>
                `,
                className: 'country-marker',
                iconSize: [48, 48],
            })
        });
        
        marker.bindPopup(`
            <div class="p-4 min-w-64">
                <div class="flex items-center mb-3">
                    <span class="text-3xl mr-3">${country.flag || 'ğŸ³ï¸'}</span>
                    <div>
                        <h4 class="font-bold text-lg">${country.name}</h4>
                        <p class="text-gray-600 text-sm">${country.code || ''}</p>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª:</span>
                        <span class="font-bold">${country.visits}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Ø§Ù„Ù†Ø³Ø¨Ø©:</span>
                        <span class="font-bold">${country.percentage.toFixed(1)}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª:</span>
                        <span class="font-bold">${country.avg_time}</span>
                    </div>
                </div>
            </div>
        `);
        
        markers.addLayer(marker);
    });
    
    worldMap.addLayer(markers);
    
    if (countries.length > 0) {
        worldMap.fitBounds(markers.getBounds());
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© =====
function formatNumber(num) {
    return new Intl.NumberFormat('ar-EG').format(num);
}

function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    
    document.getElementById('currentTime').textContent = timeString;
    document.getElementById('lastUpdateTime').textContent = timeString;
}

function refreshDashboard() {
    // ØªØ£Ø«ÙŠØ± ØªØ­Ù…ÙŠÙ„
    if (typeof gsap !== 'undefined') {
        gsap.to('body', {
            duration: 0.3,
            opacity: 0.7,
            yoyo: true,
            repeat: 1,
            ease: "power2.inOut"
        });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    setTimeout(() => {
        location.reload();
    }, 500);
}

function refreshMap() {
    if (worldMap) {
        worldMap.remove();
        initWorldMap();
    }
}

function changeTimeChart(type) {
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    console.log('ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø¥Ù„Ù‰:', type);
}

function loadRecentSessions() {
    // ØªØ£Ø«ÙŠØ± ØªØ­Ø¯ÙŠØ«
    if (typeof gsap !== 'undefined') {
        gsap.from('.realtime-card', {
            duration: 0.5,
            opacity: 0,
            y: 20,
            stagger: 0.1,
            ease: "power2.out"
        });
    }
}

function exportToPDF() {
    alert('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± PDF...');
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF
}

function exportToCSV() {
    alert('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù CSV...');
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV
}

function showFullReport() {
    window.open('/analytics/full-report/', '_blank');
}

function showSettings() {
    const modal = document.getElementById('settingsModal');
    modal.classList.remove('hidden');
    
    if (typeof gsap !== 'undefined') {
        gsap.from(modal.querySelector('div'), {
            duration: 0.4,
            scale: 0.9,
            opacity: 0,
            y: 20,
            ease: "back.out(1.7)"
        });
    }
}

function closeSettings() {
    const modal = document.getElementById('settingsModal');
    
    if (typeof gsap !== 'undefined') {
        gsap.to(modal.querySelector('div'), {
            duration: 0.3,
            scale: 0.9,
            opacity: 0,
            y: -20,
            ease: "back.in(1.7)",
            onComplete: () => {
                modal.classList.add('hidden');
            }
        });
    } else {
        modal.classList.add('hidden');
    }
}

function saveSettings() {
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    closeSettings();
}

function refreshAll() {
    updateCurrentTime();
    
    // ØªØ£Ø«ÙŠØ± ØªØ­Ø¯ÙŠØ«
    if (typeof gsap !== 'undefined') {
        gsap.to('.stat-card', {
            duration: 0.5,
            scale: 1.05,
            yoyo: true,
            repeat: 1,
            stagger: 0.1,
            ease: "power2.inOut"
        });
    }
}

let autoRefresh = false;

function toggleAutoRefresh() {
    autoRefresh = !autoRefresh;
    const status = document.getElementById('autoRefreshStatus');
    const button = event.currentTarget;
    
    if (autoRefresh) {
        status.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
        button.classList.remove('bg-green-500/20');
        button.classList.add('bg-red-500/20');
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        setInterval(refreshAll, 30000);
    } else {
        status.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
        button.classList.remove('bg-red-500/20');
        button.classList.add('bg-green-500/20');
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ©
        const intervalId = window.setInterval(() => {}, 9999);
        for (let i = 0; i < intervalId; i++) {
            window.clearInterval(i);
        }
    }
}

// ===== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙØ­Ø© =====
document.addEventListener('DOMContentLoaded', function() {
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
    initTimeChart();
    initWorldMap();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    // Ø£Ø­Ø¯Ø§Ø« ÙÙ„Ø§ØªØ± Ø§Ù„ÙØªØ±Ø©
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active');
                b.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-purple-600');
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
            this.classList.add('active');
            
            // ØªØ£Ø«ÙŠØ± GSAP
            if (typeof gsap !== 'undefined') {
                gsap.from(this, {
                    duration: 0.3,
                    scale: 0.9,
                    rotation: 5,
                    ease: "back.out(1.7)"
                });
            }
            
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©
        });
    });
    
    // ØªØ£Ø«ÙŠØ±Ø§Øª GSAP Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if (typeof gsap !== 'undefined') {
        gsap.from('.fade-in-up', {
            duration: 0.8,
            opacity: 0,
            y: 30,
            stagger: 0.1,
            ease: "power3.out",
            delay: 0.2
        });
        
        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø·ÙÙˆ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        gsap.to('.stat-card', {
            duration: 3,
            y: -5,
            yoyo: true,
            repeat: -1,
            ease: "sine.inOut",
            stagger: 0.2
        });
        
        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ£Ù„Ù‚
        setInterval(() => {
            gsap.to('.glow-effect', {
                duration: 2,
                boxShadow: '0 0 30px rgba(59, 130, 246, 0.5)',
                yoyo: true,
                repeat: 1,
                ease: "sine.inOut"
            });
        }, 5000);
        
        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        gsap.from('.icon-wrapper', {
            duration: 1,
            scale: 0,
            rotation: 360,
            stagger: 0.1,
            ease: "back.out(1.7)"
        });
    }
});
</script>
{% endblock %}